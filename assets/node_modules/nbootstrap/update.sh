#!/bin/bash
set -e
set -x

PROTOC_GEN_TS_PATH=$(npx which protoc-gen-ts)

JS_PWD=$(pwd)

pushd ..
out=pb
mkdir -p $out
protoc --go_out="plugins=grpc:$out" \
       bootstrap.proto

go build

out=$JS_PWD/pb
mkdir -p $out
protoc --plugin="protoc-gen-ts=${PROTOC_GEN_TS_PATH}" \
       --ts_out="service=grpc-web:$out" \
       --js_out="import_style=commonjs,binary:$out" \
       bootstrap.proto
popd
